

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>API &mdash; SuPA  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Changelog" href="changelog.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> SuPA
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-supa">supa</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-supa.const">supa.const</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supa-main">supa.main</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-supa.db.session">supa.db.session</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-supa.db.model">supa.db.model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#surrogate-keys-versus-natural-keys">Surrogate keys versus natural keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="#connection-ids">Connection IDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sqlalchemy-model-dependency-diagram">SQLAlchemy Model Dependency Diagram</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-supa.job.shared">supa.job.shared</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supa-job-reserve">supa.job.reserve</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-supa.connection.fsm">supa.connection.fsm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-supa.connection.error">supa.connection.error</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supa-connection-provider-server">supa.connection.provider.server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-supa.util.bandwidth">supa.util.bandwidth</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supa-util-converter">supa.util.converter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-supa.util.timestamp">supa.util.timestamp</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-supa.util.nsi">supa.util.nsi</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supa-util-vlan">supa.util.vlan</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-supa.util.functional">supa.util.functional</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SuPA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="api">
<h1>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-supa">
<span id="supa"></span><h2>supa<a class="headerlink" href="#module-supa" title="Permalink to this headline">¶</a></h2>
<p>Initial configuration for SuPA.</p>
<p>This being the top level package,
structured logging is configured here
so that it is available everywhere else by means of:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">structlog</span>
<span class="o">...</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</pre></div>
</div>
<p>All possible configurable settings are defined here as part of <a class="reference internal" href="#supa.Settings" title="supa.Settings"><code class="xref py py-class docutils literal notranslate"><span class="pre">Settings</span></code></a>.
All these settings have a default values,
that are overwritten by whatever values those settings have,
if any,
in the configuration file <code class="docutils literal notranslate"><span class="pre">supa.env</span></code>.
See also <a class="reference internal" href="#supa.resolve_env_file" title="supa.resolve_env_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">resolve_env_file()</span></code></a></p>
<dl class="py function">
<dt id="supa.get_project_root">
<code class="sig-prename descclassname">supa.</code><code class="sig-name descname">get_project_root</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; pathlib.Path<a class="headerlink" href="#supa.get_project_root" title="Permalink to this definition">¶</a></dt>
<dd><p>Return project root directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>project root directory</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt id="supa.JournalMode">
<em class="property">class </em><code class="sig-prename descclassname">supa.</code><code class="sig-name descname">JournalMode</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.JournalMode" title="Permalink to this definition">¶</a></dt>
<dd><p>A (subset) of the journal modes as supported by SQLite.</p>
<p>Preferably we should use the <a class="reference internal" href="#supa.JournalMode.WAL" title="supa.JournalMode.WAL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WAL</span></code></a> journal mode for SQLite
as that provides the best concurrency;
allowing for multiple READs to occur while a WRITE is in progress.
Without WAL,
as the journal mode,
SQLite locks the entire database as soon as a transaction starts.
As SuPA also uses SQLAlchemy,
that happens to issue a transaction upon session creation,
this could have a negative performance impact.</p>
<p>However, <a class="reference internal" href="#supa.JournalMode.WAL" title="supa.JournalMode.WAL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WAL</span></code></a> journal mode does not work well with networked file systems,
such as NFS.
This might also hold for some, or most of the Kubernetes storage volumes.
If in doubt use a <code class="docutils literal notranslate"><span class="pre">local</span></code> volume.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://sqlite.org/pragma.html#pragma_journal_mode">https://sqlite.org/pragma.html#pragma_journal_mode</a></p></li>
<li><p><a class="reference external" href="https://docs.sqlalchemy.org/en/13/dialects/sqlite.html?highlight=sqlite#database-locking-behavior-concurrency">https://docs.sqlalchemy.org/en/13/dialects/sqlite.html?highlight=sqlite#database-locking-behavior-concurrency</a></p></li>
<li><p><a class="reference external" href="https://kubernetes.io/docs/concepts/storage/volumes/#local">https://kubernetes.io/docs/concepts/storage/volumes/#local</a></p></li>
</ul>
</div>
<p>But don’t let these warnings fool you.
SQLlite is a wickedly fast database
that matches SuPA’s needs perfectly.</p>
<dl class="py attribute">
<dt id="supa.JournalMode.WAL">
<code class="sig-name descname">WAL</code><em class="property"> = 'WAL'</em><a class="headerlink" href="#supa.JournalMode.WAL" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="supa.JournalMode.TRUNCATE">
<code class="sig-name descname">TRUNCATE</code><em class="property"> = 'TRUNCATE'</em><a class="headerlink" href="#supa.JournalMode.TRUNCATE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="supa.JournalMode.DELETE">
<code class="sig-name descname">DELETE</code><em class="property"> = 'DELETE'</em><a class="headerlink" href="#supa.JournalMode.DELETE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="supa.Settings">
<em class="property">class </em><code class="sig-prename descclassname">supa.</code><code class="sig-name descname">Settings</code><span class="sig-paren">(</span><em class="sig-param">_env_file: Optional[Union[pathlib.Path</em>, <em class="sig-param">str]] = '&lt;object object&gt;'</em>, <em class="sig-param">_env_file_encoding: Optional[str] = None</em>, <em class="sig-param">*</em>, <em class="sig-param">grpc_server_max_workers: int = 8</em>, <em class="sig-param">grpc_server_insecure_address_port: str = 'localhost:50051'</em>, <em class="sig-param">grpc_client_insecure_address_port: str = 'localhost:9090'</em>, <em class="sig-param">database_journal_mode: supa.JournalMode = &lt;JournalMode.WAL: 'WAL'&gt;</em>, <em class="sig-param">database_file: pathlib.Path = PosixPath('supa.db')</em>, <em class="sig-param">scheduler_max_workers: int = 12</em>, <em class="sig-param">domain: str = 'netherlight.net:2013'</em>, <em class="sig-param">network_type: str = 'production8'</em>, <em class="sig-param">nsa_id: str = 'urn:ogf:network:netherlight.net:2013:nsa:supa'</em><span class="sig-paren">)</span><a class="headerlink" href="#supa.Settings" title="Permalink to this definition">¶</a></dt>
<dd><p>Application wide settings with default values.</p>
<p>See also: the <code class="docutils literal notranslate"><span class="pre">supa.env</span></code> file</p>
<dl class="py attribute">
<dt id="supa.Settings.grpc_server_max_workers">
<code class="sig-name descname">grpc_server_max_workers</code><em class="property">: int</em><a class="headerlink" href="#supa.Settings.grpc_server_max_workers" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="supa.Settings.grpc_server_insecure_address_port">
<code class="sig-name descname">grpc_server_insecure_address_port</code><em class="property">: str</em><a class="headerlink" href="#supa.Settings.grpc_server_insecure_address_port" title="Permalink to this definition">¶</a></dt>
<dd><p>The address and port SuPA is listening on.</p>
</dd></dl>

<dl class="py attribute">
<dt id="supa.Settings.grpc_client_insecure_address_port">
<code class="sig-name descname">grpc_client_insecure_address_port</code><em class="property">: str</em><a class="headerlink" href="#supa.Settings.grpc_client_insecure_address_port" title="Permalink to this definition">¶</a></dt>
<dd><p>The address and port the Requester Agent/PolyNSI is listening on.</p>
</dd></dl>

<dl class="py attribute">
<dt id="supa.Settings.database_journal_mode">
<code class="sig-name descname">database_journal_mode</code><em class="property">: <a class="reference internal" href="#supa.JournalMode" title="supa.JournalMode">supa.JournalMode</a></em><a class="headerlink" href="#supa.Settings.database_journal_mode" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="supa.Settings.database_file">
<code class="sig-name descname">database_file</code><em class="property">: pathlib.Path</em><a class="headerlink" href="#supa.Settings.database_file" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="supa.Settings.scheduler_max_workers">
<code class="sig-name descname">scheduler_max_workers</code><em class="property">: int</em><a class="headerlink" href="#supa.Settings.scheduler_max_workers" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="supa.Settings.domain">
<code class="sig-name descname">domain</code><em class="property">: str</em><a class="headerlink" href="#supa.Settings.domain" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="supa.Settings.network_type">
<code class="sig-name descname">network_type</code><em class="property">: str</em><a class="headerlink" href="#supa.Settings.network_type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="supa.Settings.nsa_id">
<code class="sig-name descname">nsa_id</code><em class="property">: str</em><a class="headerlink" href="#supa.Settings.nsa_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="supa.Settings.Config">
<em class="property">class </em><code class="sig-name descname">Config</code><a class="headerlink" href="#supa.Settings.Config" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py attribute">
<dt id="supa.Settings.Config.case_sensitive">
<code class="sig-name descname">case_sensitive</code><em class="property"> = True</em><a class="headerlink" href="#supa.Settings.Config.case_sensitive" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="supa.resolve_env_file">
<code class="sig-prename descclassname">supa.</code><code class="sig-name descname">resolve_env_file</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; pathlib.Path<a class="headerlink" href="#supa.resolve_env_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolve env file by looking at specific locations.</p>
<p>Depending on how the project was installed
we find the env file in different locations.
When pip performs a regular install
it will process the <code class="docutils literal notranslate"><span class="pre">data_files</span></code> sections in <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code>.
The env file is specified in that section
and the location specified there (hard coded here) is the first location checked.</p>
<p>Editable pip installs do not process that section.
Hence the location of the env file can be found relative to the top level <code class="docutils literal notranslate"><span class="pre">supa</span></code> package in the source tree
(where this code is located).
This is the second location checked.</p>
<p>If none of these locations results in finding the env file we give up.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The path where the env file was found or <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>FileNotFoundError</strong> – if the env file could not be resolved/found.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="supa.resolve_database_file">
<code class="sig-prename descclassname">supa.</code><code class="sig-name descname">resolve_database_file</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">database_file</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>pathlib.Path<span class="p">, </span>str<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; pathlib.Path<a class="headerlink" href="#supa.resolve_database_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolve the location of the database file.</p>
<p>SQLite stores its database in a file.
If the file does not exist,
it will be created automatically.
This means that if we get the reference to that file wrong,
a new one will be created.
This leads to all kinds of unexpected problems.
Hence we need a way to predictably resolve the location of the database file.
<a class="reference internal" href="#supa.resolve_database_file" title="supa.resolve_database_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">resolve_database_file()</span></code></a> uses the following algorithm:</p>
<p>If <code class="docutils literal notranslate"><span class="pre">database_file</span></code> is an absolute path, we are done.
Otherwise determine if SuPA was installed normally
or in editable mode/development mode.
In case of the former
resolve <code class="docutils literal notranslate"><span class="pre">database_file</span></code> relative to <code class="docutils literal notranslate"><span class="pre">&lt;venv_dir&gt;/var/db</span></code>
In case of the latter resolve <code class="docutils literal notranslate"><span class="pre">database_file</span></code> relative to the project root.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>database_file</strong> – relative or absolute filename of database file</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Fully resolved/obsolute path name to database file</p>
</dd>
</dl>
</dd></dl>

<dl class="py data">
<dt id="supa.settings">
<code class="sig-prename descclassname">supa.</code><code class="sig-name descname">settings</code><em class="property"> = Settings(grpc_server_max_workers=8, grpc_server_insecure_address_port='localhost:50051', grpc_client_insecure_address_port='localhost:9090', database_journal_mode=&lt;JournalMode.WAL: 'WAL'&gt;, database_file=PosixPath('supa.db'), scheduler_max_workers=12, domain='netherlight.net:2013', network_type='production8', nsa_id='urn:ogf:network:netherlight.net:2013:nsa:supa')</em><a class="headerlink" href="#supa.settings" title="Permalink to this definition">¶</a></dt>
<dd><p>Application wide settings.</p>
<p>Initially this only has the settings,
as specified in the env file and environment,
resolved.
Command line processing should overwrite specific settings,
when appropriate,
to reflect that this takes precedence.
As a result you should see code updating <a class="reference internal" href="#supa.settings" title="supa.settings"><code class="xref py py-attr docutils literal notranslate"><span class="pre">settings</span></code></a> in most,
if not all,
Click callables (sub commands) defined in <code class="xref py py-mod docutils literal notranslate"><span class="pre">supa.main</span></code></p>
</dd></dl>

<dl class="py class">
<dt id="supa.UnconfiguredScheduler">
<em class="property">class </em><code class="sig-prename descclassname">supa.</code><code class="sig-name descname">UnconfiguredScheduler</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">gconfig</span><span class="o">=</span><span class="default_value">{}</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.UnconfiguredScheduler" title="Permalink to this definition">¶</a></dt>
<dd><p>Fail safe fake scheduler to guard against premature scheduler usage.</p>
<p>The BackgroundScheduler can only be initialized after all settings have been resolved.
This means that we cannot initialize it at the module level.
After all,
at the time this module is being executed the default settings
and those of the env file have been processed,
those specified on the commend line might not have been processed.
At the same time we want to keep easy access to the <a class="reference internal" href="#supa.scheduler" title="supa.scheduler"><code class="xref py py-data docutils literal notranslate"><span class="pre">scheduler</span></code></a> as a module level attribute.
So we configure the <a class="reference internal" href="#supa.scheduler" title="supa.scheduler"><code class="xref py py-data docutils literal notranslate"><span class="pre">scheduler</span></code></a> with this safe guard class
only to overwrite it with the real thing after command line options have been processed.</p>
<dl class="py attribute">
<dt id="supa.UnconfiguredScheduler.exc_msg">
<code class="sig-name descname">exc_msg</code><em class="property"> = 'Scheduler has not yet been initialized. Call `main.init_app` first. Only then (locally) import `scheduler`.\n\nIMPORTANT\n==========\nMake sure you have processed all the different ways of dealing with application\nconfiguration before you call `main.init_app`.  The env file (`supa.env`) and\nthe environment are handled automatically by the `supa.settings` instance.\nHowever anything specified on the command line generally needs to be processed\nexplicitly in the module `supa.main`.\n'</em><a class="headerlink" href="#supa.UnconfiguredScheduler.exc_msg" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="supa.UnconfiguredScheduler.shutdown">
<code class="sig-name descname">shutdown</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">wait</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.UnconfiguredScheduler.shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>Trap premature call and raise an exception.</p>
</dd></dl>

<dl class="py method">
<dt id="supa.UnconfiguredScheduler.wakeup">
<code class="sig-name descname">wakeup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#supa.UnconfiguredScheduler.wakeup" title="Permalink to this definition">¶</a></dt>
<dd><p>Trap premature call and raise an exception.</p>
</dd></dl>

<dl class="py method">
<dt id="supa.UnconfiguredScheduler.start">
<code class="sig-name descname">start</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">paused</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.UnconfiguredScheduler.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Trap premature calls and raise an exception.</p>
</dd></dl>

<dl class="py method">
<dt id="supa.UnconfiguredScheduler.add_job">
<code class="sig-name descname">add_job</code><span class="sig-paren">(</span><em class="sig-param">func</em>, <em class="sig-param">trigger=None</em>, <em class="sig-param">args=None</em>, <em class="sig-param">kwargs=None</em>, <em class="sig-param">id=None</em>, <em class="sig-param">name=None</em>, <em class="sig-param">misfire_grace_time=&lt;undefined&gt;</em>, <em class="sig-param">coalesce=&lt;undefined&gt;</em>, <em class="sig-param">max_instances=&lt;undefined&gt;</em>, <em class="sig-param">next_run_time=&lt;undefined&gt;</em>, <em class="sig-param">jobstore='default'</em>, <em class="sig-param">executor='default'</em>, <em class="sig-param">replace_existing=False</em>, <em class="sig-param">**trigger_args</em><span class="sig-paren">)</span><a class="headerlink" href="#supa.UnconfiguredScheduler.add_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Trap premature calls and raise an exception.</p>
</dd></dl>

</dd></dl>

<dl class="py data">
<dt id="supa.scheduler">
<code class="sig-prename descclassname">supa.</code><code class="sig-name descname">scheduler</code><em class="property"> = &lt;supa.UnconfiguredScheduler object&gt;</em><a class="headerlink" href="#supa.scheduler" title="Permalink to this definition">¶</a></dt>
<dd><p>Application scheduler for scheduling and executing jobs</p>
<p><a class="reference internal" href="#supa.scheduler" title="supa.scheduler"><code class="xref py py-data docutils literal notranslate"><span class="pre">scheduler</span></code></a> can only be used after a call to <code class="xref py py-func docutils literal notranslate"><span class="pre">main.init_app()</span></code>.
That,
in turn,
can only be called after all application configuration has been resolved,
eg. after command line processing.
<code class="xref py py-func docutils literal notranslate"><span class="pre">main.init_app()</span></code> will replace <a class="reference internal" href="#supa.scheduler" title="supa.scheduler"><code class="xref py py-data docutils literal notranslate"><span class="pre">scheduler</span></code></a> with a proper <code class="docutils literal notranslate"><span class="pre">BackgroundScheduler</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt id="supa.init_app">
<code class="sig-prename descclassname">supa.</code><code class="sig-name descname">init_app</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">with_scheduler</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">True</span></em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#supa.init_app" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the application (database, scheduler, etc) and recover jobs``.</p>
<p><a class="reference internal" href="#supa.init_app" title="supa.init_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_app()</span></code></a> should only be called after <strong>all</strong> application configuration has been resolved.
Most of that happens implicitly in <a class="reference internal" href="#module-supa" title="supa"><code class="xref py py-mod docutils literal notranslate"><span class="pre">supa</span></code></a>,
but some of needs to be done after processing command line options.</p>
<p>For instance, <a class="reference internal" href="#supa.init_app" title="supa.init_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_app()</span></code></a> assumes <a class="reference internal" href="#supa.settings" title="supa.settings"><code class="xref py py-data docutils literal notranslate"><span class="pre">settings</span></code></a>
(the <a class="reference internal" href="#supa.Settings.database_file" title="supa.Settings.database_file"><code class="xref py py-attr docutils literal notranslate"><span class="pre">database_file</span></code></a> attribute of it)
has been updated <strong>after</strong> command line processing,
that is, if the setting was changed on the command line.
That way the command line options have had the ability
to override the default values, those of the env file and environment variables.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only import <code class="xref py py-data docutils literal notranslate"><span class="pre">supa.db.Session</span></code> after the call to <a class="reference internal" href="#supa.init_app" title="supa.init_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_app()</span></code></a>.
If imported earlier, <code class="xref py py-data docutils literal notranslate"><span class="pre">supa.db.Session</span></code> will refer to <code class="xref py py-class docutils literal notranslate"><span class="pre">supa.db.UnconfiguredSession</span></code>
and you will get a nice exception upon usage.</p>
<p>Likewise only import <a class="reference internal" href="#supa.scheduler" title="supa.scheduler"><code class="xref py py-data docutils literal notranslate"><span class="pre">scheduler</span></code></a> after the call to <a class="reference internal" href="#supa.init_app" title="supa.init_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_app()</span></code></a>.
If imported earlier, <a class="reference internal" href="#supa.scheduler" title="supa.scheduler"><code class="xref py py-data docutils literal notranslate"><span class="pre">scheduler</span></code></a> will refer to <a class="reference internal" href="#supa.UnconfiguredScheduler" title="supa.UnconfiguredScheduler"><code class="xref py py-class docutils literal notranslate"><span class="pre">UnconfiguredScheduler</span></code></a>
and you will get an equally nice exception.</p>
</div>
<p>If the scheduler is to be initialized as well (see: <code class="xref py py-attr docutils literal notranslate"><span class="pre">with_scheduler</span></code>)
it will also be started.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>with_scheduler</strong> – if True, initialize and start scheduler. If False, don’t.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="supa.recover_jobs">
<code class="sig-prename descclassname">supa.</code><code class="sig-name descname">recover_jobs</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#supa.recover_jobs" title="Permalink to this definition">¶</a></dt>
<dd><p>Recover jobs from a previous run with_scheduler.</p>
<p><a class="reference internal" href="#supa.recover_jobs" title="supa.recover_jobs"><code class="xref py py-func docutils literal notranslate"><span class="pre">recover_jobs()</span></code></a> should only be called after <a class="reference internal" href="#supa.init_app" title="supa.init_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">init_app()</span></code></a> was called
and the scheduler is running.</p>
<p>Try to recover all jobs that did not finish.
All af SuPA’s asynchronous work is performed by jobs that the scheduler schedules.
If SuPA is terminated before these jobs have had a chance to run to completion,
they might be recovered by looking at the state of their work in the database.</p>
<p>See Also: <a class="reference internal" href="#supa.job.shared.Job" title="supa.job.shared.Job"><code class="xref py py-class docutils literal notranslate"><span class="pre">supa.job.shared.Job</span></code></a></p>
</dd></dl>

</div>
<div class="section" id="module-supa.const">
<span id="supa-const"></span><h2>supa.const<a class="headerlink" href="#module-supa.const" title="Permalink to this headline">¶</a></h2>
<p>Application wide constants.</p>
<dl class="py data">
<dt id="supa.const.SERVICE_TYPE">
<code class="sig-prename descclassname">supa.const.</code><code class="sig-name descname">SERVICE_TYPE</code><em class="property"> = 'http://services.ogf.org/nsi/2013/12/descriptions/EVTS.A-GOLE'</em><a class="headerlink" href="#supa.const.SERVICE_TYPE" title="Permalink to this definition">¶</a></dt>
<dd><p>Currently only one Service Type is supported.</p>
</dd></dl>

</div>
<div class="section" id="supa-main">
<h2>supa.main<a class="headerlink" href="#supa-main" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-supa.db.session">
<span id="supa-db-session"></span><h2>supa.db.session<a class="headerlink" href="#module-supa.db.session" title="Permalink to this headline">¶</a></h2>
<p>Setup the DB, configure SQLAlchemy and define the schema.</p>
<p>Due to SuPA’s modest DB requirements we have chosen to use <a class="reference external" href="https://sqlite.org/index.html">SQLite</a>.
It is very easy to use,
does not require a full client/server setup,
and it is wickedly fast.
There are some limitations with regards to concurrency,
but those will not affect SuPA with its low DB WRITE needs;
especially when configured with the <a class="reference internal" href="#supa.JournalMode.WAL" title="supa.JournalMode.WAL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">WAL</span></code></a> journal mode.</p>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Due to how SuPA initializes itself,
whatever needs to be imported from this module,
needs to be imported locally!</p>
</div>
<p>When anything from this module is imported at the top of other modules
some things within this module might not yet have been correctly initialized.
Most notable the location of the SQLite database file.
Once the initialization has been completed,
these already imported objects will still refer to the old uninitialized ones.
Don’t worry too much about it;
you will get an informative error.
But just to be on the safe side,
always import anything from this module locally!</p>
<dl class="py function">
<dt id="supa.db.session.set_sqlite_pragma">
<code class="sig-prename descclassname">supa.db.session.</code><code class="sig-name descname">set_sqlite_pragma</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dbapi_connection</span><span class="p">:</span> <span class="n">sqlite3.Connection</span></em>, <em class="sig-param"><span class="n">connection_record</span><span class="p">:</span> <span class="n">sqlalchemy.pool.base._ConnectionRecord</span></em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#supa.db.session.set_sqlite_pragma" title="Permalink to this definition">¶</a></dt>
<dd><p>Configure certain SQLite settings.</p>
<p>These settings,
issued as SQLite <a class="reference external" href="https://sqlite.org/pragma.html">pragmas</a>,
need to be configured on each connection.
Hence the usage of SQLAlchemy’s engine’s connect event.</p>
</dd></dl>

<dl class="py class">
<dt id="supa.db.session.UnconfiguredSession">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.session.</code><code class="sig-name descname">UnconfiguredSession</code><a class="headerlink" href="#supa.db.session.UnconfiguredSession" title="Permalink to this definition">¶</a></dt>
<dd><p>Fail safe fake session class to guard against premature SQLAlchemy session usage.</p>
<p>SQLAlchemy’s engine,
and hence session,
can only be initialized after all settings have been resolved.
This means that we cannot initialize it at the module level.
After all,
at the time this module is being executed the default settings
and those of the env file have been processed,
those specified on the commend line might not have been processed.
At the same time we want to keep easy access to the <a class="reference internal" href="#supa.db.session.Session" title="supa.db.session.Session"><code class="xref py py-data docutils literal notranslate"><span class="pre">Session</span></code></a> as a module level attribute.
So we configure the <a class="reference internal" href="#supa.db.session.Session" title="supa.db.session.Session"><code class="xref py py-data docutils literal notranslate"><span class="pre">Session</span></code></a> with this safe guard class
only to overwrite it with the real thing after command line options have been processed.</p>
</dd></dl>

<dl class="py data">
<dt id="supa.db.session.Session">
<code class="sig-prename descclassname">supa.db.session.</code><code class="sig-name descname">Session</code><em class="property"> = &lt;supa.db.session.UnconfiguredSession object&gt;</em><a class="headerlink" href="#supa.db.session.Session" title="Permalink to this definition">¶</a></dt>
<dd><p>SQLAlchemy Session for accessing the database.</p>
<p><a class="reference internal" href="#supa.db.session.Session" title="supa.db.session.Session"><code class="xref py py-data docutils literal notranslate"><span class="pre">Session</span></code></a> can only be used after a call to <code class="xref py py-func docutils literal notranslate"><span class="pre">main.init_app()</span></code>.
That,
in turn,
can only be called after all application configuration has been resolved,
eg. after command line processing.
<code class="xref py py-func docutils literal notranslate"><span class="pre">main.init_app()</span></code> will replace <a class="reference internal" href="#supa.db.session.Session" title="supa.db.session.Session"><code class="xref py py-data docutils literal notranslate"><span class="pre">Session</span></code></a> with a proper SQLAlchemy
(scoped) <code class="docutils literal notranslate"><span class="pre">Session</span></code>.</p>
</dd></dl>

<dl class="py function">
<dt id="supa.db.session.db_session">
<code class="sig-prename descclassname">supa.db.session.</code><code class="sig-name descname">db_session</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Iterator<span class="p">[</span>sqlalchemy.orm.scoping.scoped_session<span class="p">]</span><a class="headerlink" href="#supa.db.session.db_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Context manager for using an SQLAlchemy session.</p>
<p>It will automatically commit the session upon leaving the context manager.
It will rollback the session if an exception occurred while in the context manager.
re-raising the exception afterwards.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="n">fu</span><span class="o">=</span><span class="s2">&quot;fu&quot;</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">db_session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">my_model</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>Exception</strong> – Actually whatever exception that was raised while the context manager was active.</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="module-supa.db.model">
<span id="supa-db-model"></span><h2>supa.db.model<a class="headerlink" href="#module-supa.db.model" title="Permalink to this headline">¶</a></h2>
<p>Define the database models.</p>
<div class="section" id="surrogate-keys-versus-natural-keys">
<h3>Surrogate keys versus natural keys<a class="headerlink" href="#surrogate-keys-versus-natural-keys" title="Permalink to this headline">¶</a></h3>
<p>Looking at the model definitions
you’ll find that we have used <a class="reference external" href="https://en.wikipedia.org/wiki/Natural_key">natural keys</a> wherever possible.
Though no too common these days,
with the prevalent use of ORMs
that automatically generate a <a class="reference external" href="https://en.wikipedia.org/wiki/Surrogate_key">surrogate key</a> per model,
SQLAlchemy is flexible enough to model things ‘naturally’ from a relational database point of view.
This sometimes results in <a class="reference external" href="https://en.wikipedia.org/wiki/Compound_key">composite</a> primary keys.</p>
<p>Foreign keys to these composite primary keys cannot be defined on a specific Column definition
or even a set of Column definitions.
Something that does work for composite primary key definitions.
Instead,
these foreign keys need to be defined using a
<a class="reference external" href="https://docs.sqlalchemy.org/en/13/core/constraints.html?sqlalchemy.schema.ForeignKeyConstraint#sqlalchemy.schema.ForeignKeyConstraint">ForeignKeyConstraint</a>
on the <code class="docutils literal notranslate"><span class="pre">__table_args__</span></code> attribute of the DB model.</p>
</div>
<div class="section" id="connection-ids">
<h3>Connection IDs<a class="headerlink" href="#connection-ids" title="Permalink to this headline">¶</a></h3>
<p>Looking at example messages in the different specifications:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.ogf.org/documents/GFD.233.pdf">GFD-R-233 Applying Policy in the NSI Environment (pdf)</a></p></li>
<li><p><a class="reference external" href="https://www.ogf.org/documents/GFD.237.pdf">GWD-R-P.237 NSI Connection Service v2.1 (pdf)</a></p></li>
</ul>
<p>we see that connection IDs always seem to be formatted as <code class="docutils literal notranslate"><span class="pre">UUID</span></code>’s.
However, according to its definition in GWD-R-P.237,
it can be any string as long as it is unique within the context of a PA.
That is the reason that we have modelled connection IDs from other NSA’s
(<code class="docutils literal notranslate"><span class="pre">ag_connection_id</span></code>, <code class="docutils literal notranslate"><span class="pre">upa_connection_id</span></code>)
as <code class="docutils literal notranslate"><span class="pre">TEXT</span></code>.
Within SuPA we have decided to use <code class="docutils literal notranslate"><span class="pre">UUID</span></code>’s for our <code class="docutils literal notranslate"><span class="pre">connection_id</span></code>’s.</p>
</div>
<div class="section" id="sqlalchemy-model-dependency-diagram">
<h3>SQLAlchemy Model Dependency Diagram<a class="headerlink" href="#sqlalchemy-model-dependency-diagram" title="Permalink to this headline">¶</a></h3>
<p>A visual representation of how everything is wired together
should help navigating the Python code a lot better.</p>
<img alt="_images/sqlalchemy_model_dependency_diagram.png" src="_images/sqlalchemy_model_dependency_diagram.png" />
<dl class="py class">
<dt id="supa.db.model.Uuid">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">Uuid</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.db.model.Uuid" title="Permalink to this definition">¶</a></dt>
<dd><p>Implement SQLAlchemy Uuid column type for SQLite databases.</p>
<p>This stores Python <code class="xref py py-class docutils literal notranslate"><span class="pre">uuid.UUID</span></code> types as strings (<code class="docutils literal notranslate"><span class="pre">CHAR(36)</span></code>) in the database.
We have chosen to store the <code class="xref py py-meth docutils literal notranslate"><span class="pre">uuid.UUID.__str__()</span></code> representation directly,
eg. with <code class="docutils literal notranslate"><span class="pre">&quot;-&quot;</span></code> between the UUID fields,
for improved readability.</p>
<dl class="py method">
<dt id="supa.db.model.Uuid.process_bind_param">
<code class="sig-name descname">process_bind_param</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>uuid.UUID<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">dialect</span><span class="p">:</span> <span class="n">sqlalchemy.engine.interfaces.Dialect</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>str<span class="p">]</span><a class="headerlink" href="#supa.db.model.Uuid.process_bind_param" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive a bound parameter value to be converted.</p>
<p>Subclasses override this method to return the
value that should be passed along to the underlying
<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code> object, and from there to the
DBAPI <code class="docutils literal notranslate"><span class="pre">execute()</span></code> method.</p>
<p>The operation could be anything desired to perform custom
behavior, such as transforming or serializing data.
This could also be used as a hook for validating logic.</p>
<p>This operation should be designed with the reverse operation
in mind, which would be the process_result_value method of
this class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – Data to operate upon, of any type expected by
this method in the subclass.  Can be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>dialect</strong> – the <code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code> in use.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="supa.db.model.Uuid.process_result_value">
<code class="sig-name descname">process_result_value</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">dialect</span><span class="p">:</span> <span class="n">sqlalchemy.engine.interfaces.Dialect</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>uuid.UUID<span class="p">]</span><a class="headerlink" href="#supa.db.model.Uuid.process_result_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive a result-row column value to be converted.</p>
<p>Subclasses should implement this method to operate on data
fetched from the database.</p>
<p>Subclasses override this method to return the
value that should be passed back to the application,
given a value that is already processed by
the underlying <code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code> object, originally
from the DBAPI cursor method <code class="docutils literal notranslate"><span class="pre">fetchone()</span></code> or similar.</p>
<p>The operation could be anything desired to perform custom
behavior, such as transforming or serializing data.
This could also be used as a hook for validating logic.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – Data to operate upon, of any type expected by
this method in the subclass.  Can be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>dialect</strong> – the <code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code> in use.</p></li>
</ul>
</dd>
</dl>
<p>This operation should be designed to be reversible by
the “process_bind_param” method of this class.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="supa.db.model.ReprBase">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">ReprBase</code><a class="headerlink" href="#supa.db.model.ReprBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Custom SQLAlchemy model to provide meaningful <code class="xref py py-meth docutils literal notranslate"><span class="pre">__str__()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">__repr__()</span></code> methods.</p>
<p>Writing appropriate <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> and <code class="docutils literal notranslate"><span class="pre">__str__</span></code> methods
for all your SQLAlchemy ORM models
gets tedious very quickly.
By using SQLAlchemy’s
<a class="reference external" href="https://docs.sqlalchemy.org/en/latest/core/inspection.html?highlight=runtimeinspectionapi">Runtime Inspection API</a>
this base class can easily generate these methods for you.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This class cannot be used as a regular Python base class
due to assumptions made by <code class="docutils literal notranslate"><span class="pre">declarative_base</span></code>. See <strong>Usage</strong> below instead.</p>
</div>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">ReprBase</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py exception">
<dt id="supa.db.model.UtcTimestampException">
<em class="property">exception </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">UtcTimestampException</code><a class="headerlink" href="#supa.db.model.UtcTimestampException" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception class for custom UtcTimestamp SQLAlchemy column type.</p>
</dd></dl>

<dl class="py class">
<dt id="supa.db.model.UtcTimestamp">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">UtcTimestamp</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.db.model.UtcTimestamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Custom SQLAlchemy column type for storing timestamps in UTC in SQLite databases.</p>
<p>This column type always returns timestamps with the UTC timezone.
It also guards against accidentally trying to store Python naive timestamps
(those without a time zone).</p>
<p>In the SQLite database the timestamps are stored as strings of format: <code class="docutils literal notranslate"><span class="pre">yyyy-mm-dd</span> <span class="pre">hh:mm:ss</span></code>.
<strong>UTC is always implied.</strong></p>
<dl class="py method">
<dt id="supa.db.model.UtcTimestamp.process_bind_param">
<code class="sig-name descname">process_bind_param</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>datetime.datetime<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">dialect</span><span class="p">:</span> <span class="n">sqlalchemy.engine.interfaces.Dialect</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>datetime.datetime<span class="p">]</span><a class="headerlink" href="#supa.db.model.UtcTimestamp.process_bind_param" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive a bound parameter value to be converted.</p>
<p>Subclasses override this method to return the
value that should be passed along to the underlying
<code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code> object, and from there to the
DBAPI <code class="docutils literal notranslate"><span class="pre">execute()</span></code> method.</p>
<p>The operation could be anything desired to perform custom
behavior, such as transforming or serializing data.
This could also be used as a hook for validating logic.</p>
<p>This operation should be designed with the reverse operation
in mind, which would be the process_result_value method of
this class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – Data to operate upon, of any type expected by
this method in the subclass.  Can be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>dialect</strong> – the <code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code> in use.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="supa.db.model.UtcTimestamp.process_result_value">
<code class="sig-name descname">process_result_value</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>datetime.datetime<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">dialect</span><span class="p">:</span> <span class="n">sqlalchemy.engine.interfaces.Dialect</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>datetime.datetime<span class="p">]</span><a class="headerlink" href="#supa.db.model.UtcTimestamp.process_result_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Receive a result-row column value to be converted.</p>
<p>Subclasses should implement this method to operate on data
fetched from the database.</p>
<p>Subclasses override this method to return the
value that should be passed back to the application,
given a value that is already processed by
the underlying <code class="xref py py-class docutils literal notranslate"><span class="pre">TypeEngine</span></code> object, originally
from the DBAPI cursor method <code class="docutils literal notranslate"><span class="pre">fetchone()</span></code> or similar.</p>
<p>The operation could be anything desired to perform custom
behavior, such as transforming or serializing data.
This could also be used as a hook for validating logic.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – Data to operate upon, of any type expected by
this method in the subclass.  Can be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>dialect</strong> – the <code class="xref py py-class docutils literal notranslate"><span class="pre">Dialect</span></code> in use.</p></li>
</ul>
</dd>
</dl>
<p>This operation should be designed to be reversible by
the “process_bind_param” method of this class.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="supa.db.model.Reservation">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">Reservation</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.db.model.Reservation" title="Permalink to this definition">¶</a></dt>
<dd><p>DB mapping for registering NSI reservations.</p>
<dl class="py method">
<dt id="supa.db.model.Reservation.src_stp">
<code class="sig-name descname">src_stp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">selected</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#supa.util.nsi.Stp" title="supa.util.nsi.Stp">supa.util.nsi.Stp</a><a class="headerlink" href="#supa.db.model.Reservation.src_stp" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="xref py py-class docutils literal notranslate"><span class="pre">STP</span></code> instance for src data.</p>
<p>Depending on where we are in the reservation process,
we need to deal with a requested VLAN(s)(ranges),
or a selected VLAN.
The <code class="docutils literal notranslate"><span class="pre">selected</span></code> parameter determines which of the two
will be used for the <code class="docutils literal notranslate"><span class="pre">labels</span></code> argument to the <a class="reference internal" href="#supa.util.nsi.Stp" title="supa.util.nsi.Stp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stp</span></code></a> object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>selected</strong> – if True, use ‘selected VLAN` instead of requested VLAN(s)(ranges)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference internal" href="#supa.util.nsi.Stp" title="supa.util.nsi.Stp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stp</span></code></a> object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="supa.db.model.Reservation.dst_stp">
<code class="sig-name descname">dst_stp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">selected</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#supa.util.nsi.Stp" title="supa.util.nsi.Stp">supa.util.nsi.Stp</a><a class="headerlink" href="#supa.db.model.Reservation.dst_stp" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <code class="xref py py-class docutils literal notranslate"><span class="pre">STP</span></code> instance for dst data.</p>
<p>Depending on where we are in the reservation process,
we need to deal with a requested VLAN(s)(ranges),
or a selected VLAN.
The <code class="docutils literal notranslate"><span class="pre">selected</span></code> parameter determines which of the two
will be used for the <code class="docutils literal notranslate"><span class="pre">labels</span></code> argument to the <a class="reference internal" href="#supa.util.nsi.Stp" title="supa.util.nsi.Stp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stp</span></code></a> object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>selected</strong> – if True, use ‘selected VLAN` instead of requested VLAN(s)(ranges)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference internal" href="#supa.util.nsi.Stp" title="supa.util.nsi.Stp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stp</span></code></a> object</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="supa.db.model.PathTrace">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">PathTrace</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.db.model.PathTrace" title="Permalink to this definition">¶</a></dt>
<dd><p>DB mapping for PathTraces.</p>
</dd></dl>

<dl class="py class">
<dt id="supa.db.model.Path">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">Path</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.db.model.Path" title="Permalink to this definition">¶</a></dt>
<dd><p>DB mapping for Paths.</p>
</dd></dl>

<dl class="py class">
<dt id="supa.db.model.Segment">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">Segment</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.db.model.Segment" title="Permalink to this definition">¶</a></dt>
<dd><p>DB mapping for Segment.</p>
</dd></dl>

<dl class="py class">
<dt id="supa.db.model.Stp">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">Stp</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.db.model.Stp" title="Permalink to this definition">¶</a></dt>
<dd><p>DB Mapping for STP.</p>
</dd></dl>

<dl class="py class">
<dt id="supa.db.model.Parameter">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">Parameter</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.db.model.Parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>DB mapping for PointToPointService Parameters.</p>
</dd></dl>

<dl class="py class">
<dt id="supa.db.model.Topology">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">Topology</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.db.model.Topology" title="Permalink to this definition">¶</a></dt>
<dd><p>DB mapping for ports (STPs) from the Orchestrator.</p>
</dd></dl>

<dl class="py class">
<dt id="supa.db.model.Connection">
<em class="property">class </em><code class="sig-prename descclassname">supa.db.model.</code><code class="sig-name descname">Connection</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.db.model.Connection" title="Permalink to this definition">¶</a></dt>
<dd><p>DB mapping for registering connections to be build/built.</p>
<p>It stores references to the actual :class`Topology`s used in the  connection
and the <code class="docutils literal notranslate"><span class="pre">subscription_id</span></code> of the lightpath from the Orchestrator.</p>
</dd></dl>

</div>
</div>
<div class="section" id="module-supa.job.shared">
<span id="supa-job-shared"></span><h2>supa.job.shared<a class="headerlink" href="#module-supa.job.shared" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="supa.job.shared.Job">
<em class="property">class </em><code class="sig-prename descclassname">supa.job.shared.</code><code class="sig-name descname">Job</code><a class="headerlink" href="#supa.job.shared.Job" title="Permalink to this definition">¶</a></dt>
<dd><p>Capture SuPA’s asynchronous work.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With asynchronous we don’t mean async IO, as is all the hype these days.
Instead, we refer to all the work that happens outside of the regular gRPC request/response cycle.
Asynchronous ‘work’ is an explicit aspect of the NSI protocol.</p>
</div>
<dl class="py method">
<dt id="supa.job.shared.Job.__call__">
<em class="property">abstract </em><code class="sig-name descname">__call__</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#supa.job.shared.Job.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform the work represented by this class.</p>
<p>Sub classes must override this method.
This method is called by the scheduler when the job is scheduled to run.</p>
</dd></dl>

<dl class="py method">
<dt id="supa.job.shared.Job.recover">
<em class="property">abstract classmethod </em><code class="sig-name descname">recover</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; List<span class="p">[</span><a class="reference internal" href="#supa.job.shared.Job" title="supa.job.shared.Job">supa.job.shared.Job</a><span class="p">]</span><a class="headerlink" href="#supa.job.shared.Job.recover" title="Permalink to this definition">¶</a></dt>
<dd><p>Recover work that did not run to completion due to a premature termination of SuPA.</p>
<p>When SuPA needs to be terminated,
there might still be some scheduled jobs that haven’t yet run.
These jobs might be recovered when SuPA’s is started again.
If they can, it is up to this class method to recreated these jobs.</p>
<p>This is an abstract method as we want subclasses to be explict about their recovery process.</p>
<p>See Also: <a class="reference internal" href="#supa.init_app" title="supa.init_app"><code class="xref py py-func docutils literal notranslate"><span class="pre">supa.init_app()</span></code></a></p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list of instantiated jobs to be rescheduled.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="supa.job.shared.Job.trigger">
<em class="property">abstract </em><code class="sig-name descname">trigger</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; apscheduler.triggers.date.DateTrigger<a class="headerlink" href="#supa.job.shared.Job.trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Trigger for recovered jobs.</p>
<p>Recovered jobs generally know when they should be run.
This function provides the means to tell the recovery process exactly that.</p>
<p>This is an abstract method as we want subclasses to be explicit about their trigger behaviour.</p>
<p>Whatever this <a class="reference internal" href="#supa.job.shared.Job.trigger" title="supa.job.shared.Job.trigger"><code class="xref py py-meth docutils literal notranslate"><span class="pre">trigger()</span></code></a> function returns,
is passed to the scheduler’s
<a class="reference external" href="https://apscheduler.readthedocs.io/en/latest/modules/schedulers/base.html#apscheduler.schedulers.base.BaseScheduler.add_job">add_job()</a>
method after the job has been passed into it.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">apscheduler.triggers.date</span> <span class="kn">import</span> <span class="n">DateTrigger</span>

<span class="n">my_job</span> <span class="o">=</span> <span class="n">MyJob</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">my_job</span><span class="o">.</span><span class="n">trigger</span><span class="p">()</span>  <span class="c1"># -&gt; DateTrigger(run_date=datetime(2020, 10, 8, 10, 0, tzinfo=timezone.utc))</span>

<span class="c1"># Then the recovery process will do this:</span>

<span class="n">scheduler</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">my_job</span><span class="p">,</span> <span class="n">my_job</span><span class="o">.</span><span class="n">trigger</span><span class="p">())</span>
</pre></div>
</div>
<p>If a job needs to be run immediately after recovery,
then simply return DateTrigger(run_date=None).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Tuple of arguments to be supplied to the <code class="docutils literal notranslate"><span class="pre">add_job</span></code> scheduler method.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt id="supa.job.shared.NsiException">
<em class="property">exception </em><code class="sig-prename descclassname">supa.job.shared.</code><code class="sig-name descname">NsiException</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nsi_error</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#supa.connection.error.NsiError" title="supa.connection.error.NsiError">supa.connection.error.NsiError</a></span></em>, <em class="sig-param"><span class="n">extra_info</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">variables</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Dict<span class="p">[</span><a class="reference internal" href="#supa.connection.error.Variable" title="supa.connection.error.Variable">supa.connection.error.Variable</a><span class="p">, </span>str<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.job.shared.NsiException" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception used in signalling NSI errors within SuPA.</p>
<p>NSI errors are instances of <a class="reference internal" href="#supa.connection.error.NsiError" title="supa.connection.error.NsiError"><code class="xref py py-class docutils literal notranslate"><span class="pre">NsiError</span></code></a>.
They represent a class or errors.
<a class="reference internal" href="#supa.job.shared.NsiException" title="supa.job.shared.NsiException"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NsiException</span></code></a>, on the other hand,
is used to represent a specific occurrence of an <a class="reference internal" href="#supa.connection.error.NsiError" title="supa.connection.error.NsiError"><code class="xref py py-class docutils literal notranslate"><span class="pre">NsiError</span></code></a>
with extra information about the error.
In addition it, being an exception, can be used to interrupt the regular flow of execution.</p>
<p>An <a class="reference internal" href="#supa.job.shared.NsiException" title="supa.job.shared.NsiException"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NsiException</span></code></a> will eventually be converted into a <code class="docutils literal notranslate"><span class="pre">ServiceException</span></code>.
That is a Protobuf data structure/message that will be send back to the NSA/Aggregator.
Hence an <a class="reference internal" href="#supa.job.shared.NsiException" title="supa.job.shared.NsiException"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NsiException</span></code></a> is internal.
An <code class="docutils literal notranslate"><span class="pre">ServiceException</span></code> is external.</p>
<dl class="py attribute">
<dt id="supa.job.shared.NsiException.nsi_error">
<code class="sig-name descname">nsi_error</code><em class="property">: <a class="reference internal" href="#supa.connection.error.NsiError" title="supa.connection.error.NsiError">supa.connection.error.NsiError</a></em><a class="headerlink" href="#supa.job.shared.NsiException.nsi_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Type of error that occurred.</p>
</dd></dl>

<dl class="py attribute">
<dt id="supa.job.shared.NsiException.extra_info">
<code class="sig-name descname">extra_info</code><em class="property">: str</em><a class="headerlink" href="#supa.job.shared.NsiException.extra_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Extra information about the specifics of the error that occurred.</p>
</dd></dl>

<dl class="py attribute">
<dt id="supa.job.shared.NsiException.variables">
<code class="sig-name descname">variables</code><em class="property">: Dict<span class="p">[</span><a class="reference internal" href="#supa.connection.error.Variable" title="supa.connection.error.Variable">supa.connection.error.Variable</a><span class="p">, </span>str<span class="p">]</span></em><a class="headerlink" href="#supa.job.shared.NsiException.variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Additional information about the specifics of the error that occurred.</p>
<p>The difference between <a class="reference internal" href="#supa.job.shared.NsiException.extra_info" title="supa.job.shared.NsiException.extra_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">extra_info</span></code></a> and <a class="reference internal" href="#supa.job.shared.NsiException.variables" title="supa.job.shared.NsiException.variables"><code class="xref py py-attr docutils literal notranslate"><span class="pre">variables</span></code></a>
is that the former in primarily meant to provide a meaningful message to the end user.
Whereas the latter is intended as a <em>a structured machine readable version</em>  of <a class="reference internal" href="#supa.job.shared.NsiException.extra_info" title="supa.job.shared.NsiException.extra_info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">extra_info</span></code></a>.</p>
<p>This difference is of importance
when the <a class="reference internal" href="#supa.job.shared.NsiException" title="supa.job.shared.NsiException"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NsiException</span></code></a> is converted into it’s Protobuf equivalent: the <code class="docutils literal notranslate"><span class="pre">ServiceException</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt id="supa.job.shared.NsiException.text">
<em class="property">property </em><code class="sig-name descname">text</code><a class="headerlink" href="#supa.job.shared.NsiException.text" title="Permalink to this definition">¶</a></dt>
<dd><p>Return text message of the exception/error.</p>
<p>This combines information from the attached <a class="reference internal" href="#supa.connection.error.NsiError" title="supa.connection.error.NsiError"><code class="xref py py-class docutils literal notranslate"><span class="pre">NsiError</span></code></a>
and the <code class="xref py py-attr docutils literal notranslate"><span class="pre">etxra_info</span></code>.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="supa.job.shared.send_service_exception">
<code class="sig-prename descclassname">supa.job.shared.</code><code class="sig-name descname">send_service_exception</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">nsi_exc</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#supa.job.shared.NsiException" title="supa.job.shared.NsiException">supa.job.shared.NsiException</a></span></em>, <em class="sig-param"><span class="n">connection_id</span><span class="p">:</span> <span class="n">uuid.UUID</span></em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#supa.job.shared.send_service_exception" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a NSI service exception referencing the connection_id with details from the NsiException.</p>
</dd></dl>

</div>
<div class="section" id="supa-job-reserve">
<h2>supa.job.reserve<a class="headerlink" href="#supa-job-reserve" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-supa.connection.fsm">
<span id="supa-connection-fsm"></span><h2>supa.connection.fsm<a class="headerlink" href="#module-supa.connection.fsm" title="Permalink to this headline">¶</a></h2>
<p>Define the three NSI Connection Service state machines.</p>
<p>The NSI Connection Service defines three state machines that,
together with the message processing functions (=coordinator functions in NSI parlance),
model the behaviour of the protocol.</p>
<p>They are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#supa.connection.fsm.ReservationStateMachine" title="supa.connection.fsm.ReservationStateMachine"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReservationStateMachine</span></code></a> (RSM)</p></li>
<li><p><a class="reference internal" href="#supa.connection.fsm.ProvisionStateMachine" title="supa.connection.fsm.ProvisionStateMachine"><code class="xref py py-class docutils literal notranslate"><span class="pre">ProvisionStateMachine</span></code></a> (PSM)</p></li>
<li><p><a class="reference internal" href="#supa.connection.fsm.LifecycleStateMachine" title="supa.connection.fsm.LifecycleStateMachine"><code class="xref py py-class docutils literal notranslate"><span class="pre">LifecycleStateMachine</span></code></a> (LSM)</p></li>
</ul>
<p>The state machines explicitly regulate the sequence in which messages are processed.
The CS messages are each assigned to one of the three state machines:
RSM, PSM and LSM.
When the first reserve request for a new Connection is received,
the function processing the reserve requests MUST coordinate the creation of the
RSM, PSM and LSM
state machines for that specific connection.</p>
<p>The RSM and LSM MUST be instantiated as soon as the first Connection request is received.</p>
<p>The PSM MUST be instantiated as soon as the first version of the reservation is committed.</p>
<dl class="py class">
<dt id="supa.connection.fsm.SuPAStateMachine">
<em class="property">class </em><code class="sig-prename descclassname">supa.connection.fsm.</code><code class="sig-name descname">SuPAStateMachine</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.connection.fsm.SuPAStateMachine" title="Permalink to this definition">¶</a></dt>
<dd><p>Add logging capabilities to StateMachine.</p>
<dl class="py method">
<dt id="supa.connection.fsm.SuPAStateMachine.on_enter_state">
<code class="sig-name descname">on_enter_state</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">state</span><span class="p">:</span> <span class="n">statemachine.statemachine.State</span></em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#supa.connection.fsm.SuPAStateMachine.on_enter_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Statemachine will call this function on every state transition.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="supa.connection.fsm.ReservationStateMachine">
<em class="property">class </em><code class="sig-prename descclassname">supa.connection.fsm.</code><code class="sig-name descname">ReservationStateMachine</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.connection.fsm.ReservationStateMachine" title="Permalink to this definition">¶</a></dt>
<dd><p>Reservation State Machine.</p>
<img alt="_images/ReservationStateMachine.png" src="_images/ReservationStateMachine.png" />
</dd></dl>

<dl class="py class">
<dt id="supa.connection.fsm.ProvisionStateMachine">
<em class="property">class </em><code class="sig-prename descclassname">supa.connection.fsm.</code><code class="sig-name descname">ProvisionStateMachine</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.connection.fsm.ProvisionStateMachine" title="Permalink to this definition">¶</a></dt>
<dd><p>Provision State Machine.</p>
<img alt="_images/ProvisionStateMachine.png" src="_images/ProvisionStateMachine.png" />
</dd></dl>

<dl class="py class">
<dt id="supa.connection.fsm.LifecycleStateMachine">
<em class="property">class </em><code class="sig-prename descclassname">supa.connection.fsm.</code><code class="sig-name descname">LifecycleStateMachine</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.connection.fsm.LifecycleStateMachine" title="Permalink to this definition">¶</a></dt>
<dd><p>Lifecycle State Machine.</p>
<img alt="_images/LifecycleStateMachine.png" src="_images/LifecycleStateMachine.png" />
</dd></dl>

</div>
<div class="section" id="module-supa.connection.error">
<span id="supa-connection-error"></span><h2>supa.connection.error<a class="headerlink" href="#module-supa.connection.error" title="Permalink to this headline">¶</a></h2>
<p>Predefined NSI errors.</p>
<p>The errors are not defined in the NSI Connection Service v2.1 specification.
Instead there is a separate document
<a class="reference external" href="https://www.ogf.org/documents/GFD.235.pdf">Error Handling in NSI CS 2.1</a>
that specifies these errors.</p>
<p>Not all errors might be applicable to SuPA’s operation,
it being a Provider Agent,
though all have been included for reference.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Predefined NSI errors</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">error_id</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">error_code</span></code></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">descriptive_text</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>GenericMessagePayLoadError</p></td>
<td><p>00100</p></td>
<td><p>GENERIC_MESSAGE_PAYLOAD_ERROR</p></td>
<td><p>Illegal message payload.</p></td>
</tr>
<tr class="row-odd"><td><p>MissingParameter</p></td>
<td><p>00101</p></td>
<td><p>MISSING_PARAMETER</p></td>
<td><p>Invalid or missing parameter.</p></td>
</tr>
<tr class="row-even"><td><p>UnsupportedParameter</p></td>
<td><p>00102</p></td>
<td><p>UNSUPPORTED_PARAMETER</p></td>
<td><p>Provided parameter contains an unsupported value that MUST be processed.</p></td>
</tr>
<tr class="row-odd"><td><p>NotImplemented</p></td>
<td><p>00103</p></td>
<td><p>NOT_IMPLEMENTED</p></td>
<td><p>Requested feature has not been implemented.</p></td>
</tr>
<tr class="row-even"><td><p>VersionNotSupported</p></td>
<td><p>00104</p></td>
<td><p>VERSION_NOT_SUPPORTED</p></td>
<td><p>The protocol version requested is not supported.</p></td>
</tr>
<tr class="row-odd"><td><p>GenericConnectionError</p></td>
<td><p>00200</p></td>
<td><p>GENERIC_CONNECTION_ERROR</p></td>
<td><p>A connection error has occurred.</p></td>
</tr>
<tr class="row-even"><td><p>InvalidTransition</p></td>
<td><p>00201</p></td>
<td><p>INVALID_TRANSITION</p></td>
<td><p>Connection state machine is in invalid state for received message.</p></td>
</tr>
<tr class="row-odd"><td><p>ReservationNonExistent</p></td>
<td><p>00203</p></td>
<td><p>RESERVATION_NONEXISTENT</p></td>
<td><p>Schedule does not exist for connectionId.</p></td>
</tr>
<tr class="row-even"><td><p>GenericSecurityError</p></td>
<td><p>00300</p></td>
<td><p>GENERIC_SECURITY_ERROR</p></td>
<td><p>A security error has occurred.</p></td>
</tr>
<tr class="row-odd"><td><p>Unauthorized</p></td>
<td><p>00302</p></td>
<td><p>UNAUTHORIZED</p></td>
<td><p>Insufficient authorization to perform requested operation.</p></td>
</tr>
<tr class="row-even"><td><p>GenericMetadataError</p></td>
<td><p>00400</p></td>
<td><p>GENERIC_METADATA_ERROR</p></td>
<td><p>A topology or generic path computation error has occurred.</p></td>
</tr>
<tr class="row-odd"><td><p>DomainLookupError</p></td>
<td><p>00405</p></td>
<td><p>DOMAIN_LOOKUP_ERROR</p></td>
<td><p>Unknown network for requested resource.</p></td>
</tr>
<tr class="row-even"><td><p>NsaLookupError</p></td>
<td><p>00406</p></td>
<td><p>NSA_LOOKUP_ERROR</p></td>
<td><p>Cannot map networkId to service interface.</p></td>
</tr>
<tr class="row-odd"><td><p>NoServiceplanePathFound</p></td>
<td><p>00407</p></td>
<td><p>NO_SERVICEPLANE_PATH_FOUND</p></td>
<td><p>No service plane path for selected connection segments.</p></td>
</tr>
<tr class="row-even"><td><p>GenericInternalError</p></td>
<td><p>00500</p></td>
<td><p>GENERIC_INTERNAL_ERROR</p></td>
<td><p>An internal error has caused a message processing failure.</p></td>
</tr>
<tr class="row-odd"><td><p>ChildSegmentError</p></td>
<td><p>00502</p></td>
<td><p>CHILD_SEGMENT_ERROR</p></td>
<td><p>Child connection segment error is present.</p></td>
</tr>
<tr class="row-even"><td><p>MessageDeliveryError</p></td>
<td><p>00503</p></td>
<td><p>MESSAGE_DELIVERY_ERROR</p></td>
<td><p>Failed message delivery to peer NSA.</p></td>
</tr>
<tr class="row-odd"><td><p>GenericResourceUnavailable</p></td>
<td><p>00600</p></td>
<td><p>GENERIC_RESOURCE_UNAVAILABLE</p></td>
<td><p>A requested resource(s) is not available.</p></td>
</tr>
<tr class="row-even"><td><p>GenericServiceError</p></td>
<td><p>00700</p></td>
<td><p>GENERIC_SERVICE_ERROR</p></td>
<td><p>A service specific error has occurred.</p></td>
</tr>
<tr class="row-odd"><td><p>UnknownStp</p></td>
<td><p>00701</p></td>
<td><p>UNKNOWN_STP</p></td>
<td><p>Could not find STP in topology database.</p></td>
</tr>
<tr class="row-even"><td><p>LabelSwappingNotSupported</p></td>
<td><p>00703</p></td>
<td><p>LABEL_SWAPPING_NOT_SUPPORTED</p></td>
<td><p>Label swapping not supported for requested path.</p></td>
</tr>
<tr class="row-odd"><td><p>StpUnavailable</p></td>
<td><p>00704</p></td>
<td><p>STP_UNAVALABLE</p></td>
<td><p>Specified STP already in use.</p></td>
</tr>
<tr class="row-even"><td><p>CapacityUnavailable</p></td>
<td><p>00705</p></td>
<td><p>CAPACITY_UNAVAILABLE</p></td>
<td><p>Insufficient capacity available for reservation.</p></td>
</tr>
<tr class="row-odd"><td><p>DirectionalityMismatch</p></td>
<td><p>00706</p></td>
<td><p>DIRECTIONALITY_MISMATCH</p></td>
<td><p>Directionality of specified STP does not match request directionality.</p></td>
</tr>
<tr class="row-even"><td><p>InvalidEroMember</p></td>
<td><p>00707</p></td>
<td><p>INVALID_ERO_MEMBER</p></td>
<td><p>Invalid ERO member detected.</p></td>
</tr>
<tr class="row-odd"><td><p>UnknownLabelType</p></td>
<td><p>00708</p></td>
<td><p>UNKNOWN_LABEL_TYPE</p></td>
<td><p>Specified STP contains an unknown label type.</p></td>
</tr>
<tr class="row-even"><td><p>InvalidLabelFormat</p></td>
<td><p>00709</p></td>
<td><p>INVALID_LABEL_FORMAT</p></td>
<td><p>Specified STP contains an invalid label.</p></td>
</tr>
<tr class="row-odd"><td><p>NoTransportplanePathFound</p></td>
<td><p>00710</p></td>
<td><p>NO_TRANSPORTPLANE_PATH_FOUND</p></td>
<td><p>Path computation failed to resolve route for reservation.</p></td>
</tr>
<tr class="row-even"><td><p>GenericRmError</p></td>
<td><p>00800</p></td>
<td><p>GENERIC_RM_ERROR</p></td>
<td><p>An internal (N)RM error has caused a message processing failure.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt id="supa.connection.error.Variable">
<em class="property">class </em><code class="sig-prename descclassname">supa.connection.error.</code><code class="sig-name descname">Variable</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.connection.error.Variable" title="Permalink to this definition">¶</a></dt>
<dd><p>Variable to namespace mapping.</p>
<p>This is a peculiarity of the original SOAP underpinning of the NSI protocol.
Even though all that is XML has largely been abstracted away from us
by using the Protobuf version of NSI,
we still need to track certain things
to facilitate a proper translation between the two protocol versions.
The namespace associated with each variable (in the <cite>ServiceException`</cite>) is such a thing.</p>
</dd></dl>

<dl class="py class">
<dt id="supa.connection.error.NsiError">
<em class="property">class </em><code class="sig-prename descclassname">supa.connection.error.</code><code class="sig-name descname">NsiError</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">error_id</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">error_code</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">descriptive_text</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.connection.error.NsiError" title="Permalink to this definition">¶</a></dt>
<dd><p>Predefined NSI errors.</p>
<p>Reporting of these errors happens as part of the <code class="docutils literal notranslate"><span class="pre">ServiceException</span></code> message.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">text</span></code> field of the <code class="docutils literal notranslate"><span class="pre">ServiceException</span></code> should be made up of three parts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">error_code</span><span class="p">:</span> <span class="n">descriptive_text</span> <span class="p">[</span><span class="n">extra</span> <span class="n">information</span><span class="p">]</span>
</pre></div>
</div>
<dl class="py attribute">
<dt id="supa.connection.error.NsiError.error_id">
<code class="sig-name descname">error_id</code><em class="property">: str</em><a class="headerlink" href="#supa.connection.error.NsiError.error_id" title="Permalink to this definition">¶</a></dt>
<dd><p>An unique ID for the error.</p>
<p>The <a class="reference internal" href="#supa.connection.error.NsiError.error_id" title="supa.connection.error.NsiError.error_id"><code class="xref py py-attr docutils literal notranslate"><span class="pre">error_id</span></code></a> can optionally be included in the <code class="docutils literal notranslate"><span class="pre">ServiceException</span></code>.</p>
</dd></dl>

<dl class="py attribute">
<dt id="supa.connection.error.NsiError.error_code">
<code class="sig-name descname">error_code</code><em class="property">: str</em><a class="headerlink" href="#supa.connection.error.NsiError.error_code" title="Permalink to this definition">¶</a></dt>
<dd><p>Human readable name of the error.</p>
<p>The <a class="reference internal" href="#supa.connection.error.NsiError.error_code" title="supa.connection.error.NsiError.error_code"><code class="xref py py-attr docutils literal notranslate"><span class="pre">error_code</span></code></a> should always be included in the <code class="docutils literal notranslate"><span class="pre">ServiceException</span></code>.</p>
</dd></dl>

<dl class="py attribute">
<dt id="supa.connection.error.NsiError.descriptive_text">
<code class="sig-name descname">descriptive_text</code><em class="property">: str</em><a class="headerlink" href="#supa.connection.error.NsiError.descriptive_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Descriptive text explaining the error.</p>
<p>The <code class="xref py py-attr docutils literal notranslate"><span class="pre">text</span></code> should always be included in the <code class="docutils literal notranslate"><span class="pre">ServiceException</span></code>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="supa-connection-provider-server">
<h2>supa.connection.provider.server<a class="headerlink" href="#supa-connection-provider-server" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-supa.util.bandwidth">
<span id="supa-util-bandwidth"></span><h2>supa.util.bandwidth<a class="headerlink" href="#module-supa.util.bandwidth" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="supa.util.bandwidth.format_bandwidth">
<code class="sig-prename descclassname">supa.util.bandwidth.</code><code class="sig-name descname">format_bandwidth</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mbits</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="o">*</span></em>, <em class="sig-param"><span class="n">short</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#supa.util.bandwidth.format_bandwidth" title="Permalink to this definition">¶</a></dt>
<dd><p>Format bandwidth with unit designator (eg, Mbit/s or M).</p>
<ul class="simple">
<li><p>It supports units up to and including Petabit.</p></li>
<li><p>If it cannot convert the number to an integral one, it will allow for 1 decimal.</p></li>
<li><p>Negative bandwidths will always return 0 Mbit/s or 0 M</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">format_bandwidth</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
<span class="go">&#39;40 Mbit/s&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">format_bandwidth</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">short</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;40M&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">format_bandwidth</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="go">&#39;10 Gbit/s&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">format_bandwidth</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">short</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">&#39;10G&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">format_bandwidth</span><span class="p">(</span><span class="mi">1300</span><span class="p">)</span>
<span class="go">&#39;1.3 Gbit/s&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">format_bandwidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">&#39;0 Mbit/s&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">format_bandwidth</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="go">&#39;0 Mbit/s&#39;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mbits</strong> – number of mbits</p></li>
<li><p><strong>short</strong> – boolean indicating whether to use ‘M’, ‘G’ or ‘Mbit/s’ or ‘Gbit/s’, etc</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Formatted number with unit designator.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="supa-util-converter">
<h2>supa.util.converter<a class="headerlink" href="#supa-util-converter" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-supa.util.timestamp">
<span id="supa-util-timestamp"></span><h2>supa.util.timestamp<a class="headerlink" href="#module-supa.util.timestamp" title="Permalink to this headline">¶</a></h2>
<p>Assorted helper functions and datastructures for dealing with timestamps.</p>
<dl class="py data">
<dt id="supa.util.timestamp.EPOCH">
<code class="sig-prename descclassname">supa.util.timestamp.</code><code class="sig-name descname">EPOCH</code><em class="property"> = datetime.datetime(1970, 1, 1, 0, 0, tzinfo=datetime.timezone.utc)</em><a class="headerlink" href="#supa.util.timestamp.EPOCH" title="Permalink to this definition">¶</a></dt>
<dd><p>The epoch as an aware datetime object.</p>
<p>When using protobuf you can <strong>not</strong> distinguish between
no value specified
and the default value.
For Protobuf <code class="docutils literal notranslate"><span class="pre">Timestamp</span></code> fields the default value is 0 seconds since the epoch.
However we deal with <code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code> objects exclusively.
So we need the epoch as a <code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code> object.</p>
</dd></dl>

<dl class="py data">
<dt id="supa.util.timestamp.NO_END_DATE">
<code class="sig-prename descclassname">supa.util.timestamp.</code><code class="sig-name descname">NO_END_DATE</code><em class="property"> = datetime.datetime(2108, 1, 1, 0, 0, tzinfo=datetime.timezone.utc)</em><a class="headerlink" href="#supa.util.timestamp.NO_END_DATE" title="Permalink to this definition">¶</a></dt>
<dd><p>A sufficiently far into the future date to be considered <em>no end date</em></p>
<p>Date/time calculations are easier when we have an actual date to work with.
Hence, to model “no end date” we need to come up with a date
that is far enough into the future to be considered “forever”.
Randomly picking a large number for the year of such a date feels inappropriate;
we can be a lot more geeky about it than that.</p>
<p>So, a somewhat geeky candidate is the first prime number after (the year) 2020.
That happens to be 2081;
61 years into the future.
Although we have high hopes for SuPA,
we don’t expect it to last that long.
As such, it does meet the criterion to be considered “forever”.
But the fact that it starts with “20xx
might not make it immediately obvious that this is the “no end date” date.</p>
<p>If we shuffle a bit with the digits of that prime number we get 2108.
A date that starts with “21xx” should make it sufficiently different
from all the other real end dates.
On top of that it is a somewhat a geeky date as well.
That is, if you like (military) SciFi
and have read The Frontlines Series by Marko Kloos,
which is set in the year 2108.
All criteria have now been met.</p>
</dd></dl>

<dl class="py function">
<dt id="supa.util.timestamp.current_timestamp">
<code class="sig-prename descclassname">supa.util.timestamp.</code><code class="sig-name descname">current_timestamp</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; datetime.datetime<a class="headerlink" href="#supa.util.timestamp.current_timestamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an “aware” UTC timestamp for “now”.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>An “aware” UTC timestamp.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="supa.util.timestamp.as_utc_timestamp">
<code class="sig-prename descclassname">supa.util.timestamp.</code><code class="sig-name descname">as_utc_timestamp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timestamp</span><span class="p">:</span> <span class="n">google.protobuf.timestamp_pb2.Timestamp</span></em><span class="sig-paren">)</span> &#x2192; datetime.datetime<a class="headerlink" href="#supa.util.timestamp.as_utc_timestamp" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert Protobuf timestamp to an UTC datetime object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>timestamp</strong> – Protobuf timestamp</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>“aware” UTC datetime object</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="supa.util.timestamp.is_specified">
<code class="sig-prename descclassname">supa.util.timestamp.</code><code class="sig-name descname">is_specified</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime.datetime</span></em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#supa.util.timestamp.is_specified" title="Permalink to this definition">¶</a></dt>
<dd><p>Test to see if the timestamp is specified.</p>
<p>In the context of Protobuf Timestamps
we consider a timestamp
(previously converted to <code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code>)
to be “specified”
if it is larger than the default value for Timestamps.
That default value being <a class="reference internal" href="#supa.util.timestamp.EPOCH" title="supa.util.timestamp.EPOCH"><code class="xref py py-data docutils literal notranslate"><span class="pre">EPOCH</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>timestamp</strong> – timestamp under test.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> &gt; EPOC</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-supa.util.nsi">
<span id="supa-util-nsi"></span><h2>supa.util.nsi<a class="headerlink" href="#module-supa.util.nsi" title="Permalink to this headline">¶</a></h2>
<p>NSI specific functions and datastructures.</p>
<dl class="py data">
<dt id="supa.util.nsi.URN_PREFIX">
<code class="sig-prename descclassname">supa.util.nsi.</code><code class="sig-name descname">URN_PREFIX</code><em class="property"> = 'urn:ogf:network'</em><a class="headerlink" href="#supa.util.nsi.URN_PREFIX" title="Permalink to this definition">¶</a></dt>
<dd><p>URN namespace for Network Resources.</p>
</dd></dl>

<dl class="py class">
<dt id="supa.util.nsi.Stp">
<em class="property">class </em><code class="sig-prename descclassname">supa.util.nsi.</code><code class="sig-name descname">Stp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">domain</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">network_type</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">port</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">labels</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>str<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.util.nsi.Stp" title="Permalink to this definition">¶</a></dt>
<dd><p>Dataclass for representing the constituent parts of an STP identifier.</p>
<dl class="py method">
<dt id="supa.util.nsi.Stp.vlan_ranges">
<em class="property">property </em><code class="sig-name descname">vlan_ranges</code><a class="headerlink" href="#supa.util.nsi.Stp.vlan_ranges" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the vlan ranges specified on the STP.</p>
<p>A single
If no vlan ranges where specified on the STP,
this will return an “empty” <a class="reference internal" href="#supa.util.vlan.VlanRanges" title="supa.util.vlan.VlanRanges"><code class="xref py py-class docutils literal notranslate"><span class="pre">VlanRanges</span></code></a> object.
Such an object will evaluate to False in a boolean context.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A <a class="reference internal" href="#supa.util.vlan.VlanRanges" title="supa.util.vlan.VlanRanges"><code class="xref py py-class docutils literal notranslate"><span class="pre">VlanRanges</span></code></a> object.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="supa.util.nsi.parse_stp">
<code class="sig-prename descclassname">supa.util.nsi.</code><code class="sig-name descname">parse_stp</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">stp</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#supa.util.nsi.Stp" title="supa.util.nsi.Stp">supa.util.nsi.Stp</a><a class="headerlink" href="#supa.util.nsi.parse_stp" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse STP identifier in its constituent parts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>stp</strong> – Identifier of the STP</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><a class="reference internal" href="#supa.util.nsi.Stp" title="supa.util.nsi.Stp"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stp</span></code></a> dataclass</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>object</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="supa-util-vlan">
<h2>supa.util.vlan<a class="headerlink" href="#supa-util-vlan" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-supa.util.vlan"></span><p>VlanRanges object for easy VLAN ranges processing.</p>
<dl class="py class">
<dt id="supa.util.vlan.VlanRanges">
<em class="property">class </em><code class="sig-prename descclassname">supa.util.vlan.</code><code class="sig-name descname">VlanRanges</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">val</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Union<span class="p">[</span>str<span class="p">, </span>int<span class="p">, </span>Iterable<span class="p">[</span>int<span class="p">]</span><span class="p">, </span>Sequence<span class="p">[</span>Sequence<span class="p">[</span>int<span class="p">]</span><span class="p">]</span><span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#supa.util.vlan.VlanRanges" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent VLAN ranges.</p>
<p>This class is quite liberal in what it accepts as valid VLAN ranges. All of:</p>
<ul class="simple">
<li><p>overlapping ranges</p></li>
<li><p>ranges with start value &gt; stop value</p></li>
<li><p>ranges with extraneous whitespace</p></li>
</ul>
<p>are all accepted and normalized to a canonical value.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># These are all equivalent</span>
<span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;4,10-12,11-14&quot;</span><span class="p">)</span>
<span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;4,  ,11 - 14, 10-  12&quot;</span><span class="p">)</span>
<span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;4,10-14&quot;</span><span class="p">)</span>
<span class="n">VlanRanges</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">])</span>
<span class="n">VlanRanges</span><span class="p">([[</span><span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">14</span><span class="p">]])</span>
<span class="n">VlanRanges</span><span class="p">([(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">)])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This class support most <code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code> operations.</p>
</div>
<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.to_list_of_tuples">
<code class="sig-name descname">to_list_of_tuples</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; List<span class="p">[</span>Tuple<span class="p">[</span>int<span class="p">, </span>int<span class="p">]</span><span class="p">]</span><a class="headerlink" href="#supa.util.vlan.VlanRanges.to_list_of_tuples" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct list of tuples representing the VLAN ranges.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;10 - 12, 8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_list_of_tuples</span><span class="p">()</span>
<span class="go">[(8, 8), (10, 12)]</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The VLAN ranges as contained in this object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__contains__">
<code class="sig-name descname">__contains__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span><span class="p">:</span> <span class="n">object</span></em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#supa.util.vlan.VlanRanges.__contains__" title="Permalink to this definition">¶</a></dt>
<dd><p>Membership test.</p>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__iter__">
<code class="sig-name descname">__iter__</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Iterator<span class="p">[</span>int<span class="p">]</span><a class="headerlink" href="#supa.util.vlan.VlanRanges.__iter__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an iterator that iterates over all the VLANs.</p>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__len__">
<code class="sig-name descname">__len__</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; int<a class="headerlink" href="#supa.util.vlan.VlanRanges.__len__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of VLANs represented by this VlanRanges object.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Number of VLAN’s</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__str__">
<code class="sig-name descname">__str__</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#supa.util.vlan.VlanRanges.__str__" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an as compact as possible string representation of VLAN ranges.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;1,2,3,4,5-10,8&quot;</span><span class="p">))</span>
<span class="go">&#39;1-10&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__repr__">
<code class="sig-name descname">__repr__</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#supa.util.vlan.VlanRanges.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>Create string representation of the VLAN ranges that can be used as a valid Python expression.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">repr</span><span class="p">(</span><span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;1,2,3,4,5-10,8&quot;</span><span class="p">))</span>
<span class="go">&#39;VlanRanges([(1, 10)])&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__eq__">
<code class="sig-name descname">__eq__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">o</span><span class="p">:</span> <span class="n">object</span></em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#supa.util.vlan.VlanRanges.__eq__" title="Permalink to this definition">¶</a></dt>
<dd><p>Test for equality.</p>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__hash__">
<code class="sig-name descname">__hash__</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; int<a class="headerlink" href="#supa.util.vlan.VlanRanges.__hash__" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate hash value.</p>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__sub__">
<code class="sig-name descname">__sub__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">other</span><span class="p">:</span> <span class="n">Union<span class="p">[</span>int<span class="p">, </span>AbstractSet<span class="p">[</span>Any<span class="p">]</span><span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#supa.util.vlan.VlanRanges" title="supa.util.vlan.VlanRanges">supa.util.vlan.VlanRanges</a><a class="headerlink" href="#supa.util.vlan.VlanRanges.__sub__" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove VLANs from left operand that are in the right operand.</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;1-10&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;5-8&quot;</span><span class="p">)</span>
<span class="go">VlanRanges([(1, 4), (9, 10)])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__and__">
<code class="sig-name descname">__and__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">other</span><span class="p">:</span> <span class="n">AbstractSet<span class="p">[</span>Any<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#supa.util.vlan.VlanRanges" title="supa.util.vlan.VlanRanges">supa.util.vlan.VlanRanges</a><a class="headerlink" href="#supa.util.vlan.VlanRanges.__and__" title="Permalink to this definition">¶</a></dt>
<dd><p>Intersection of two VlanRanges objects.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;10-20&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;20-30&quot;</span><span class="p">)</span>
<span class="go">VlanRanges([(20, 20)])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__or__">
<code class="sig-name descname">__or__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">other</span><span class="p">:</span> <span class="n">AbstractSet<span class="p">[</span>Any<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#supa.util.vlan.VlanRanges" title="supa.util.vlan.VlanRanges">supa.util.vlan.VlanRanges</a><a class="headerlink" href="#supa.util.vlan.VlanRanges.__or__" title="Permalink to this definition">¶</a></dt>
<dd><p>Union of two VlanRanges objects.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;10-20&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;20-30&quot;</span><span class="p">)</span>
<span class="go">VlanRanges([(10, 30)])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.__xor__">
<code class="sig-name descname">__xor__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">other</span><span class="p">:</span> <span class="n">AbstractSet<span class="p">[</span>Any<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#supa.util.vlan.VlanRanges" title="supa.util.vlan.VlanRanges">supa.util.vlan.VlanRanges</a><a class="headerlink" href="#supa.util.vlan.VlanRanges.__xor__" title="Permalink to this definition">¶</a></dt>
<dd><p>Symmetric difference of two VlanRanges objects.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;10-20&quot;</span><span class="p">)</span> <span class="o">^</span> <span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;20-30&quot;</span><span class="p">)</span>
<span class="go">VlanRanges([(10, 19), (21, 30)])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.isdisjoint">
<code class="sig-name descname">isdisjoint</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">other</span><span class="p">:</span> <span class="n">Iterable<span class="p">[</span>Any<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#supa.util.vlan.VlanRanges.isdisjoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Return True if the VlanRanges object has no VLANs in common with the other VlanRanges object.</p>
</dd></dl>

<dl class="py method">
<dt id="supa.util.vlan.VlanRanges.union">
<code class="sig-name descname">union</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">others</span><span class="p">:</span> <span class="n">AbstractSet<span class="p">[</span>Any<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#supa.util.vlan.VlanRanges" title="supa.util.vlan.VlanRanges">supa.util.vlan.VlanRanges</a><a class="headerlink" href="#supa.util.vlan.VlanRanges.union" title="Permalink to this definition">¶</a></dt>
<dd><p>Union of two or more VlanRanges objects.</p>
<p>This does work with sets as well.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;10-20&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">VlanRanges</span><span class="p">(</span><span class="s2">&quot;20-30&quot;</span><span class="p">),</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">})</span>
<span class="go">VlanRanges([(1, 4), (10, 30)])</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-supa.util.functional">
<span id="supa-util-functional"></span><h2>supa.util.functional<a class="headerlink" href="#module-supa.util.functional" title="Permalink to this headline">¶</a></h2>
<p>Assorted helper functions for representing the same data in different ways.</p>
<dl class="py function">
<dt id="supa.util.functional.expand_ranges">
<code class="sig-prename descclassname">supa.util.functional.</code><code class="sig-name descname">expand_ranges</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ranges</span><span class="p">:</span> <span class="n">Sequence<span class="p">[</span>Sequence<span class="p">[</span>int<span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">inclusive</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; List<span class="p">[</span>int<span class="p">]</span><a class="headerlink" href="#supa.util.functional.expand_ranges" title="Permalink to this definition">¶</a></dt>
<dd><p>Expand sequence of range definitions into sorted and deduplicated list of individual values.</p>
<p>A range definition is either a:</p>
<ul class="simple">
<li><p>one element sequence -&gt; an individual value.</p></li>
<li><p>two element sequence -&gt; a range of values (either inclusive or exclusive).</p></li>
</ul>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expand_ranges</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]])</span>
<span class="go">[1, 2, 10, 11]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expand_ranges</span><span class="p">([[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]],</span> <span class="n">inclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">[1, 2, 10, 11, 12]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expand_ranges</span><span class="p">([[]])</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">ValueError</span>: <span class="n">Expected 1 or 2 element list for range definition. Got f0 element list instead.</span>
</pre></div>
</div>
<p>Resulting list is sorted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expand_ranges</span><span class="p">([[</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">inclusive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">[1, 2, 3, 4, 100]</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ranges</strong> – sequence of range definitions</p></li>
<li><p><strong>inclusive</strong> – are the stop values of the range definition inclusive or exclusive.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Sorted deduplicated list of individual values.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>ValueError</strong> – if range definition is not a one or two element sequence.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="supa.util.functional.to_ranges">
<code class="sig-prename descclassname">supa.util.functional.</code><code class="sig-name descname">to_ranges</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">i</span><span class="p">:</span> <span class="n">Iterable<span class="p">[</span>int<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; Iterable<span class="p">[</span>range<span class="p">]</span><a class="headerlink" href="#supa.util.functional.to_ranges" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a sorted iterable of ints to an iterable of range objects.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The iterable passed in should be sorted and not contain duplicate elements.</p>
</div>
<dl>
<dt>Examples::</dt><dd><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">to_ranges</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">61</span><span class="p">]))</span>
<span class="go">[range(2, 6), range(7, 10), range(45, 48), range(49, 50), range(51, 52), range(53, 62)]</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>i</strong> – sorted iterable</p>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>range object for each consecutive set of integers</p>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="changelog.html" class="btn btn-neutral float-left" title="Changelog" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, SURF

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>